{"code":"!function(t){var e={};function i(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,i),o.l=!0,o.exports}i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(t,\"__esModule\",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&\"object\"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,\"default\",{enumerable:!0,value:t}),2&e&&\"string\"!=typeof t)for(var o in t)i.d(n,o,function(e){return t[e]}.bind(null,o));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,\"a\",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p=\"\",i(i.s=0)}([function(t,e,i){\"use strict\";function n(t,e){let i=t;return i.width=t.width*e,i.height=t.height*e,i}i.r(e);class o{constructor(t,e){this.modelData=t,this.genomOptions=e}inherite(t){0!=h(0,this.genomOptions.mutationRatio)?(this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this.color=t.color,this.genomOptions.onlyOneShape?this.shape=this.genomOptions.oneShape:this.shape=t.shape):this.random()}random(){this.x=h(0,this.modelData.width),this.y=h(0,this.modelData.height),this.width=h(this.genomOptions.minWidth,this.genomOptions.maxWidth),this.height=h(this.genomOptions.minHeight,this.genomOptions.maxHeight),this.genomOptions.onlySourceColors?this.color=this.genomOptions.sourceColors[h(0,this.genomOptions.sourceColors.length-1)]:this.color=[h(0,255),h(0,255),h(0,255)],this.genomOptions.onlyOneShape?this.shape=this.genomOptions.oneShape:this.shape=h(0,1)}print(){console.log(`x :${this.x}, y ${this.y}, size : ${this.size}, color : ${this.color}, shape : ${this.shape}`)}}function h(t,e){return t+Math.floor(Math.random()*Math.floor(e+1))}class a{constructor(t,e,i){this.nGenotype=e,this.adn=new Array,this.modelData=t,this.genomOptions=i}random(){for(let t=0;t<this.nGenotype;t++){let t=new o(this.modelData,this.genomOptions);t.random(),this.adn.push(t)}}inherite(t,e){for(let i=0;i<this.nGenotype;i++){let n=new o(this.modelData,this.genomOptions);0==randBtw(0,1)?n.inherite(t.adn[i]):n.inherite(e.adn[i]),this.adn.push(n)}}print(){console.table(this.adn)}generate(){let t=document.createElement(\"canvas\");t.width=this.modelData.width,t.height=this.modelData.height;let e=t.getContext(\"2d\");e.beginPath(),e.rect(0,0,this.modelData.width,this.modelData.height),e.fillStyle=\"rgb(0, 0, 0)\",e.fill();for(const t of this.adn){const{x:i,y:n,width:o,height:h,color:a,shape:s}=t;switch(e.beginPath(),s){case 0:e.rect(i-o/2,n-h/2,o,h);break;case 1:e.ellipse(i,n,o,h,0,0,2*Math.PI)}e.fillStyle=`rgb(${a[0]},${a[1]},${a[2]})`,e.fill()}return e.getImageData(0,0,this.modelData.width,this.modelData.height)}}class s{constructor(t,e={},i={}){this.modelData=t,this.ratio=this.getRatio(300),this.minifyModelData=scaleImageData(this.modelData,this.ratio),this.options=Object.assign({},{phenotypePerGeneration:50,genotypePerPhenotype:1e3},e),this.genomOptions=Object.assign({},{minWidth:4,maxWidth:16,minHeight:4,maxHeight:16,onlyOneShape:!1,oneShape:0,onlySourceColors:!0,mutationRatio:500},i),this.genomOptions.onlySourceColors&&(this.genomOptions=Object.assign({},{sourceColors:getAllUniquePixels(this.minifyModelData)},this.genomOptions)),this.generation=new Array,this.generationCounter=0,this.initialiseCanvas();for(let t=0;t<this.options.phenotypePerGeneration;t++){let t=new a(this.modelData,this.options.genotypePerPhenotype,this.genomOptions);t.random(),this.generation=[...this.generation,t]}for(let t=0;t<this.options.phenotypePerGeneration;t++)this.generation[t].similarityRatio=similarityBtwImageData(this.minifyModelData,scaleImageData(this.generation[t].generate(),this.ratio));this.generation.sort((t,e)=>t.similarityRatio-e.similarityRatio),window.setInterval(()=>{this.nextGeneration()},1)}getRatio(t){let e=this.modelData.width,i=this.modelData.height,n=1;return n=e>i?t/e:t/i}nextGeneration(){let t=[];this.generationCounter++;for(let e=0;e<1*this.options.phenotypePerGeneration/10;e++)t=[...t,this.generation[this.options.phenotypePerGeneration-1-e]];for(let e=1*this.options.phenotypePerGeneration/10;e<9*this.options.phenotypePerGeneration/10;e++)t=[...t,this.makeChildren()];for(let e=9*this.options.phenotypePerGeneration/10;e<this.options.phenotypePerGeneration;e++){let e=new a(this.modelData,this.options.genotypePerPhenotype,this.genomOptions);e.random(),t=[...t,e]}this.generation=t;for(let t=1*this.options.phenotypePerGeneration/10;t<this.options.phenotypePerGeneration;t++)this.generation[t].similarityRatio=similarityBtwImageData(this.minifyModelData,scaleImageData(this.generation[t].generate(),this.ratio));this.generation.sort((t,e)=>t.similarityRatio-e.similarityRatio),this.drawExample();let e=0;for(let t=0;t<this.options.phenotypePerGeneration;t++)e+=this.generation[t].similarityRatio;console.log(\"Generation nÂ°\"+this.generationCounter+\" Best : \"+this.generation[this.options.phenotypePerGeneration-1].similarityRatio+\", total : \"+e/this.options.phenotypePerGeneration)}makeChildren(){let t=this.rankSelection(),e=this.rankSelection();for(;e==t;)e=this.rankSelection();let i=new a(this.modelData,this.options.genotypePerPhenotype,this.genomOptions);return i.inherite(this.generation[t],this.generation[e]),i}rankSelection(){var t=0;for(let e=0;e<this.options.phenotypePerGeneration;e++)t+=2*e;var e=randBtw(0,t);t=0;for(let i=0;i<this.options.phenotypePerGeneration;i++)if(e<=(t+=2*i))return i}drawExample(){let t=this.generation[this.options.phenotypePerGeneration-1];document.querySelector(\".genetic .result canvas\").getContext(\"2d\").putImageData(t.generate(),0,0)}initialiseCanvas(){let t=document.querySelector(\".genetic .result canvas\");t.width=this.modelData.width,t.height=this.modelData.height}}var r,l,p;r=\"./examples/animal.jpg\",l=(t=>{new s(t,{phenotypePerGeneration:20,genotypePerPhenotype:1e3},{minWidth:6,maxWidth:12,minHeight:6,maxHeight:12,onlyOneShape:!0,oneShape:1})}),(p=new Image).onload=(()=>{p=function(t,e){if(t.width<e&&t.height<e)return t;let i=t;return i=i.width>i.height?n(i,e/i.width):n(i,e/i.height)}(p,600);let t=document.querySelector(\".genetic .model canvas\"),e=t.getContext(\"2d\");t.width=p.width,t.height=p.height,e.drawImage(p,0,0,p.width,p.height),l(function(t){let e=document.createElement(\"canvas\"),i=e.getContext(\"2d\");return e.width=t.width,e.height=t.height,i.drawImage(t,0,0,t.width,t.height),i.getImageData(0,0,t.width,t.height)}(p))}),p.src=r,p.crossOrigin=\"Anonymous\"}]);","extractedComments":[]}